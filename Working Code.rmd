---
title: "Topic 3: Proteome-wide Screen for RNA-dependent Proteins; Subtopic 3: HeLa synchronized in Mitosis"
author: "Jimena, Alexandra, Verena"
date: "2023-05-05"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Topic 3.3: HeLa Cells Synchronized in Mitosis

### Proteome-wide Screen for RNA-dependent Proteins

Load the dataset from the Dropbox

```{r}
RDeeP_HeLa_Mitosis = read.csv("https://www.dropbox.com/s/ttj1z98mxefq0aj/RDeeP_HeLa_Mitosis.csv?dl=1", header=TRUE, row.names=1, sep = ";")
head(RDeeP_HeLa_Mitosis)
```

## 1. Preparing data for analysis (Data Cleanup)

#### 1.1 Data description

```{r}
dim(RDeeP_HeLa_Mitosis)
head(rownames(RDeeP_HeLa_Mitosis))
head(colnames(RDeeP_HeLa_Mitosis))
```

#### 1.2 Finding rows with missing values

Finding which rows are all 0 (and are most likely experimental errors). And removing this rows.

```{r}
which(rowSums(RDeeP_HeLa_Mitosis)==0)

print(RDeeP_HeLa_Mitosis["KLD10_HUMAN",])

RDeeP_HeLa_Mitosis <- RDeeP_HeLa_Mitosis[-which(rowSums(RDeeP_HeLa_Mitosis)==0),] #Habe hier das letzte Komma hinzugefügt und das = in ein <- geändert.

#Tabelle ohne die Nullzeile wieder in der Variable gespeichert

dim(RDeeP_HeLa_Mitosis)
```

#### 1.3 Handeling other wierd rows

When looking at the dataset we noticed that already the first 7 rows have accumulation of protein in every fraction. We are not sure if we can work with them as they maybe have no clear peak, therefore we first identify them and then maybe delete them later.

```{r}
# Find rows without any zeros
nonzero_rows <- RDeeP_HeLa_Mitosis[rowSums(RDeeP_HeLa_Mitosis == 0) == 0, ]

#The condition rowSums(RDeep_Hela_Mitosis == 0) == 0 checks which rows have a sum of zeros equal to zero, indicating that those rows do *not* contain any zeros.Then we selects these rows without any zeros from our table and store it in a new table.

# Print the rows without any zeros
print(nonzero_rows)
nrow(nonzero_rows) #320 rows do not have zeros


#Possibly deleting these nonzero rows and storing it in the original matrix:
#RDeeP_HeLa_Mitosis <- RDeeP_HeLa_Mitosis[rowSums(RDeeP_HeLa_Mitosis == 0) > 0, ]

```

#### 1.4 Check data format

Here we try to determine data type of our dataset, whether it is numerical, categorical, etc
```{r}

nrow(RDeeP_HeLa_Mitosis)
ncol(RDeeP_HeLa_Mitosis)
sum(apply(RDeeP_HeLa_Mitosis, 1, is.na)) # Summe aller Spalten, die NA Werte haben
sum(apply(RDeeP_HeLa_Mitosis, 2, is.na)) # Summe aller Zeilen, die NA Werte haben
sum(apply(RDeeP_HeLa_Mitosis, 1, is.numeric))
sum(apply(RDeeP_HeLa_Mitosis, 2, is.numeric))

#sum(apply(RDeeP_HeLa_Mitosis, 1, is.numeric)) == nrow(RDeeP_HeLa_Mitosis)

```

This means we have numeric data, aka the data from the mass spectrometry.

```{r}
#Complete DataSet
View(RDeeP_HeLa_Mitosis)
```

#### 1.5 Checking reproducibility with student t-test

The first step would be to perform a student t-test on the first three values in our table, so for example protein 1, Control Fraction 1 the rep1, rep2, rep3

```{r}
# Extract the first three values from the table
protein1_Ctrl_frac1 <- RDeeP_HeLa_Mitosis[1, 1:3]

# Perform the t-test
t_test_result <- t.test(protein1_Ctrl_frac1)

# Print the t-test result
print(t_test_result)
```
Here our p-value is over 5%, thus we can determine the reproducibility of the experiment is not given and we would have to delete the entire protein. How much sense this makes we will see later. 

Now the same for protein 8

```{r}
# Extract the first three values from the table
protein8_Ctrl_frac1 <- RDeeP_HeLa_Mitosis[8, 1:3]

# Perform the t-test
t_test_result <- t.test(protein8_Ctrl_frac1)

# Print the t-test result
print(t_test_result)
```
Here all three repetitions were 0, thus making our p-value not determinable. This is normal and we would have to repeat this for all fractions and then check if there are any p-values in the entire protein above 5%. If not, we can confidently confirm the reproducibility.

Here an attempt to generalize the code for all fractions for one Protein (Control and RNAse separate)

```{r}
#easiest way is to separatly define the columns we want to put into the new dataframe

RDeeP_HeLa_Mitosis_Ctrl = cbind(RDeeP_HeLa_Mitosis[,1:3],RDeeP_HeLa_Mitosis[,7:9],RDeeP_HeLa_Mitosis[,13:15],RDeeP_HeLa_Mitosis[,19:21],RDeeP_HeLa_Mitosis[,25:27],RDeeP_HeLa_Mitosis[,31:33],RDeeP_HeLa_Mitosis[,37:39],RDeeP_HeLa_Mitosis[,43:45],RDeeP_HeLa_Mitosis[,49:51],RDeeP_HeLa_Mitosis[,55:57],RDeeP_HeLa_Mitosis[,61:63],RDeeP_HeLa_Mitosis[,67:69],RDeeP_HeLa_Mitosis[,73:75],RDeeP_HeLa_Mitosis[,79:81],RDeeP_HeLa_Mitosis[,85:87],RDeeP_HeLa_Mitosis[,91:93],RDeeP_HeLa_Mitosis[,97:99],RDeeP_HeLa_Mitosis[,103:105],RDeeP_HeLa_Mitosis[,109:111],RDeeP_HeLa_Mitosis[,115:117],RDeeP_HeLa_Mitosis[,121:123],RDeeP_HeLa_Mitosis[,127:129],RDeeP_HeLa_Mitosis[,133:135],RDeeP_HeLa_Mitosis[,139:141],RDeeP_HeLa_Mitosis[,145:147])

#For RNase it is easier, because we now can just take all the row which were not taken in the first table. 
RDeeP_HeLa_Mitosis_RNase=RDeeP_HeLa_Mitosis[,-which(names(RDeeP_HeLa_Mitosis) %in% colnames(RDeeP_HeLa_Mitosis_Ctrl))]

head(RDeeP_HeLa_Mitosis_RNase)
```

Now in the next step we try to apply a student t-test on every three values, and then finding the maxima of all these p-values.

```{r}
#THIS CODE IS NOT WORKING YET! BUT IT IS AN BEGINNING IDEA...

# Create an empty data frame to store the p-values
p_values_Ctrl <- data.frame()

# Iterate over the rows of the original table
for (i in 1:nrow(RDeeP_HeLa_Mitosis_Ctrl)) {
  # Extract the values for the current row
  row_values <- RDeeP_HeLa_Mitosis_Ctrl[i, ]
  
  # Perform the t-test on the row values and calculate the p-value
  t_result <- t.test(row_values[1:3])
  p_value <- t_result$p.value
  
  # Add the p-value to the new table
  p_values_Ctrl <- rbind(p_values_Ctrl, p_value)
}

#Optional, rename the column:
colnames(p_values_Ctrl) <- paste("P-Values", 1:(ncol(p_values_Ctrl)))

head(p_values_Ctrl)

```


#### 1.6 Checking reproducubility with correlation?



